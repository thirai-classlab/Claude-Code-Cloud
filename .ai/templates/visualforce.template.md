# Visualforce ページ 設計書テンプレート

目的: Visualforce ページの画面仕様、コントローラ連携、権限/セキュリティ、テスト基準を明確にするテンプレート。

---

## メタ
- title: <short title>
- feature_name: <FEATURE_NAME>
- module: visualforce
- source_path: force-app/main/default/pages/<PageName>.page
- controller: <ApexController or standardController>
- extensions: [<ApexExtension1>, <ApexExtension2>]
- generated_at: <ISO8601>

---

## 目次
1. [概要](#1-概要)
2. [画面設計](#2-画面設計)
3. [コントローラ/拡張クラス仕様](#3-コントローラ拡張クラス仕様)
4. [データ設計/依存](#4-データ設計依存)
5. [プログラム仕様チェックリスト](#5-プログラム仕様チェックリスト)
6. [個別処理（ステップ詳細）](#6-個別処理ステップ詳細)
7. [デプロイ/手順](#7-デプロイ手順)
8. [変更仕様マトリクス](#8-変更仕様マトリクス)
9. [改訂履歴](#9-改訂履歴)

---

## 1. 概要
- ページの目的、対象ユーザ、利用シナリオ
- 使用コントローラ: 標準/カスタム/拡張。SOQL/コールアウト有無

## 2. 画面設計
- 画面構成（レイアウト/コンテナ/コンポーネント含む <apex:*> タグ）
- 入力/表示項目一覧（ラベル/（API 名）/型/必須/初期値/バリデーション/権限制御）
- アクション/コマンド（<apex:commandButton> 等）→ コントローラメソッド/遷移先 対応表
- ページ状態と遷移（ローディング/編集/保存/エラー）
- エラーハンドリング/メッセージ表示（<apex:messages> 等）
- レスポンシブ・i18n・アクセシビリティ（ARIA/キーボード操作）
- Mermaid 図: 任意（flowchart TD）。ノード/エッジに本文アンカー参照（click 指令）

## 3. コントローラ/拡張クラス仕様
- 使用クラス、プロパティ、公開メソッド、@AuraEnabled/RemoteAction、SOQL/トランザクション境界
- CRUD/FLS/Sharing の考慮、with/without sharing 方針

## 4. データ設計/依存
- 関係オブジェクト/項目（表示ラベル優先＋API 名併記）と出典（doc/object/*.md）
- Named Credentials/外部サービス/Static Resources

## 5. プログラム仕様チェックリスト
- 入力バリデーション
- ボタン/アクション → メソッド呼出し/遷移検証
- CRUD/FLS/Sharing 準拠
- 例外時の UI メッセージ
- SOQL 条件/ビュー権限
- パフォーマンス（SOQL 件数/ガバナ/再レンダリング）
- アクセシビリティ/i18n

## 6. 個別処理（ステップ詳細）
- 日本語見出し＋英小文字スラッグのアンカー併記（例: `### 保存処理 (anchor: handle-save)`）
- 入力/出力/前提/アルゴリズム/エラーとリカバリ/権限

## 7. デプロイ/手順
- 依存関係、必要権限、設定項目
- ソース先頭への Design Doc コメントリンク追加（<!-- Design Doc: URL -->）

---

## 8. 変更仕様マトリクス
| 発生場所(Where) | 発火タイミング/条件(When/If) | 方式 | 対象オブジェクト | 対象レコード特定条件 | 対象項目(Label/API/型) | 変更内容(Before→After/算出式) | 権限要件 | 例外時動作/リトライ | ログ/監査 | 備考 |
|---|---|---|---|---|---|---|---|---|---|---|

## 9. 改訂履歴
| バージョン | 日付 | セクション | 追加機能 | ヒアリング（相手/根拠） | 変更者 | 備考 |
|---|---|---|---|---|---|---|
| 0.1 | YYYY-MM-DD | 概要 | 初版 | Yes(<stakeholder>/meeting) | <author> | - |
